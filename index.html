<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Card Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- Dark Mode Theme --- */
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #D1D5DB; /* text-gray-300 */
        }
        .main-panel {
            background-color: #1F2937; /* bg-gray-800 */
        }
        canvas { 
            max-width: 100%; 
            height: auto; 
            border-radius: 0.5rem; 
            background-color: #374151; /* bg-gray-700 */
        }
        .form-input {
            width: 100%; 
            padding: 0.5rem; 
            border: 1px solid #4B5563; /* border-gray-600 */
            border-radius: 0.5rem; 
            background-color: #374151; /* bg-gray-700 */
            color: #F9FAFB; /* text-gray-50 */
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus { 
            outline: none; 
            border-color: #3B82F6; 
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); 
        }
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 500; text-align: center; cursor: pointer; transition: background-color 0.2s, transform 0.1s; }
        .btn:not(:disabled):hover { transform: translateY(-1px); }
        .btn:disabled { background-color: #4B5563; color: #9CA3AF; cursor: not-allowed; }
        .btn-primary { background-color: #3B82F6; color: white; }
        .btn-primary:not(:disabled):hover { background-color: #2563EB; }
        .btn-secondary { background-color: #10B981; color: white; }
        .btn-secondary:not(:disabled):hover { background-color: #059669; }
        .btn-purple { background-color: #8B5CF6; color: white; }
        .btn-purple:not(:disabled):hover { background-color: #7C3AED; }
        .spinner {
            animation: spin 1s linear infinite;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            margin-right: 0.5rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <div class="container mx-auto p-4 md:p-8">
        <div class="main-panel p-8 rounded-xl shadow-2xl shadow-black/20">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white">Bulk Card Generator</h1>
                <p class="text-gray-400 mt-2">Buat kartu dengan data custom atau data acak secara otomatis.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 items-start">
                <!-- Kolom Input -->
                <div class="space-y-6">
                    <!-- Data Statis -->
                    <div class="space-y-4">
                        <h2 class="text-lg font-semibold text-gray-200">1. Atur Data Kartu</h2>
                        <div>
                            <label for="firstName" class="block text-sm font-medium text-gray-400">FIRST NAME</label>
                            <input type="text" id="firstName" class="form-input mt-1" value="XLABS">
                        </div>
                        <div>
                            <label for="endName" class="block text-sm font-medium text-gray-400">END NAME</label>
                            <input type="text" id="endName" class="form-input mt-1" value="PROJECT">
                        </div>
                        <div>
                            <label for="address1" class="block text-sm font-medium text-gray-400">ADDRESS 1 (Tetap)</label>
                            <input type="text" id="address1" class="form-input mt-1" value="7915 NORTON AVE,">
                        </div>
                        <div>
                            <label for="address2" class="block text-sm font-medium text-gray-400">ADDRESS 2 (Tetap)</label>
                            <input type="text" id="address2" class="form-input mt-1" value="LOS ANGELES, CA, 90046-5204,">
                        </div>
                         <div>
                            <label class="block text-sm font-medium text-gray-400">EXP (Tahun 2027)</label>
                            <div class="flex space-x-2 mt-1">
                                <input type="number" id="expDay" class="form-input" placeholder="Tgl" value="09" min="1" max="31">
                                <input type="number" id="expMonth" class="form-input" placeholder="Bln" value="02" min="1" max="12">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400">DOB</label>
                            <div class="flex space-x-2 mt-1">
                                <input type="number" id="dobDay" class="form-input" placeholder="Tgl" value="19" min="1" max="31">
                                <input type="number" id="dobMonth" class="form-input" placeholder="Bln" value="12" min="1" max="12">
                                <input type="number" id="dobYear" class="form-input" placeholder="Thn" value="2003">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Generator Tunggal -->
                    <div class="border-t border-gray-700 pt-6">
                        <h2 class="text-lg font-semibold text-gray-200">2. Bantuan Data Acak</h2>
                         <button id="randomizeFormBtn" class="btn btn-primary w-full mt-2">Isi Form dengan Data Acak</button>
                    </div>

                    <!-- Bulk Generator -->
                    <div class="border-t border-gray-700 pt-6">
                        <h2 class="text-lg font-semibold text-gray-200">3. Buat Kartu Massal (Bulk)</h2>
                        <div class="mt-2">
                             <label for="bulkCount" class="block text-sm font-medium text-gray-400">Jumlah Kartu</label>
                             <input type="number" id="bulkCount" class="form-input mt-1" value="10">
                        </div>
                        <button id="bulkGenerateBtn" class="btn btn-purple w-full mt-4">
                            <span>Buat & Unduh ZIP</span>
                        </button>
                        <p id="status" class="text-sm text-gray-500 mt-2 text-center h-5"></p>
                    </div>
                </div>

                <!-- Kolom Canvas/Preview -->
                <div class="space-y-4 sticky top-8">
                    <h2 class="text-lg font-semibold text-gray-200 text-center">Pratinjau</h2>
                    <div class="bg-gray-900 p-2 rounded-lg flex justify-center items-center">
                        <canvas id="canvas"></canvas>
                    </div>
                    <div class="text-center">
                        <a id="downloadBtn" class="btn btn-secondary" >Unduh Gambar Pratinjau</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Elemen UI ---
        const downloadBtn = document.getElementById('downloadBtn');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const randomizeFormBtn = document.getElementById('randomizeFormBtn');
        const bulkGenerateBtn = document.getElementById('bulkGenerateBtn');
        const bulkCountInput = document.getElementById('bulkCount');
        const statusText = document.getElementById('status');
        
        const dataInputs = {
            firstName: document.getElementById('firstName'),
            endName: document.getElementById('endName'),
            address1: document.getElementById('address1'),
            address2: document.getElementById('address2'),
            expDay: document.getElementById('expDay'),
            expMonth: document.getElementById('expMonth'),
            dobDay: document.getElementById('dobDay'),
            dobMonth: document.getElementById('dobMonth'),
            dobYear: document.getElementById('dobYear'),
        };

        // --- State Management ---
        let loadedImage = null;
        let currentCode = '';
        
        // --- DATA RANDOM ---
        const firstNames = ["William", "James", "Michael", "John", "David", "Robert", "Christopher", "Daniel", "Matthew", "Anthony", "Joseph", "Andrew", "Joshua", "Nicholas", "Jonathan", "Stephen", "Benjamin", "Samuel", "Gregory", "Patrick", "Alexander", "Jack", "Thomas", "Henry", "Charles", "Walter", "Dennis", "Jerry", "Arthur", "Lawrence", "Paul", "Kevin", "Jason", "Scott", "Jeffrey", "Frank", "Gary", "Timothy", "Ronald", "Edward", "Brian", "Richard", "Kenneth", "Steven", "George", "Donald", "Mark", "Eric", "Roger", "Terry", "Gerald", "Keith", "Harold", "Carl", "Eugene", "Russell", "Bobby", "Howard", "Raymond", "Carlos", "Louis", "Adam", "Harry", "Wayne", "Billy", "Steve", "Albert", "Randy", "Philip", "Johnny", "Roy", "Jimmy", "Willie", "Noah", "Liam", "Mason", "Jacob", "Ethan", "Lucas", "Logan", "Jackson", "Aiden", "Owen", "Caleb", "Ryan", "Connor", "Luke", "Wyatt", "Isaac", "Nathan", "Carter", "Gabriel", "Leo", "Eli", "Levi", "Aaron", "Julian", "Hudson", "Lincoln", "Christian", "Jeremiah", "Elias"];
        const lastNames = ["Smith", "Johnson", "Williams", "Brown", "Jones", "Garcia", "Miller", "Davis", "Rodriguez", "Martinez", "Hernandez", "Lopez", "Gonzalez", "Wilson", "Anderson", "Thomas", "Taylor", "Moore", "Jackson", "Martin", "Lee", "Perez", "Thompson", "White", "Harris", "Sanchez", "Clark", "Ramirez", "Lewis", "Robinson", "Walker", "Young", "Allen", "King", "Wright", "Scott", "Torres", "Nguyen", "Hill", "Flores", "Green", "Adams", "Nelson", "Baker", "Hall", "Rivera", "Campbell", "Mitchell", "Carter", "Roberts", "Gomez", "Phillips", "Evans", "Turner", "Diaz", "Parker", "Cruz", "Edwards", "Collins", "Reyes", "Stewart", "Morris", "Morales", "Murphy", "Cook", "Rogers", "Gutierrez", "Ortiz", "Morgan", "Cooper", "Peterson", "Bailey", "Reed", "Kelly", "Howard", "Ramos", "Kim", "Cox", "Ward", "Richardson", "Watson", "Brooks", "Chavez", "Wood", "James", "Bennett", "Gray", "Mendoza", "Ruiz", "Hughes", "Price", "Alvarez", "Castillo", "Sanders", "Patel", "Myers", "Long", "Ross", "Foster", "Jimenez"];

        // KONFIGURASI FINAL
        const textElements = [
            { id: 'kode', x: 393, y: 177, size: 43, color: '#ca0e20' },
            { id: 'exp', x: 406, y: 230, size: 43, color: '#ca0e20' },
            { id: 'firstName', x: 393, y: 271, size: 38, color: 'white' }, // Warna diubah ke putih
            { id: 'endName', x: 391, y: 306, size: 38, color: 'white' }, // Warna diubah ke putih
            { id: 'address1', x: 351, y: 342, size: 28, color: 'white' }, // Warna diubah ke putih
            { id: 'address2', x: 351, y: 371, size: 28, color: 'white' }, // Warna diubah ke putih
            { id: 'dob', x: 409, y: 406, size: 37, color: '#ca0e20' }
        ];

        // --- Functions ---
        const toTitleCase = (str) => {
            if (!str) return '';
            return str.toLowerCase().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        };
        const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const pad = (num) => num.toString().padStart(2, '0');

        const generateRandomData = () => {
            return {
                code: 'M' + Math.floor(1000000 + Math.random() * 9000000),
                expDay: pad(Math.floor(Math.random() * 28) + 1),
                expMonth: pad(Math.floor(Math.random() * 12) + 1),
                firstName: getRandomElement(firstNames),
                endName: getRandomElement(lastNames),
                dobDay: pad(Math.floor(Math.random() * 28) + 1),
                dobMonth: pad(Math.floor(Math.random() * 12) + 1),
            };
        };
        
        const populateFormWithRandomData = () => {
            const randomData = generateRandomData();
            currentCode = randomData.code;
            dataInputs.firstName.value = randomData.firstName;
            dataInputs.endName.value = randomData.endName;
            dataInputs.expDay.value = randomData.expDay;
            dataInputs.expMonth.value = randomData.expMonth;
            dataInputs.dobDay.value = randomData.dobDay;
            dataInputs.dobMonth.value = randomData.dobMonth;
            redrawCanvasFromForm();
        };

        const loadImage = (src) => {
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = () => {
                loadedImage = img;
                canvas.width = img.width;
                canvas.height = img.height;
                currentCode = 'M' + Math.floor(1000000 + Math.random() * 9000000);
                redrawCanvasFromForm();
            };
            img.src = src;
        };

        const redrawCanvas = (data) => {
            if (!loadedImage) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(loadedImage, 0, 0);

            textElements.forEach(el => {
                let textValue = '';
                switch (el.id) {
                    case 'kode': textValue = data.code; break;
                    case 'exp': textValue = `${data.expDay}/${data.expMonth}/2027`; break;
                    case 'dob': textValue = `${data.dobDay}/${data.dobMonth}/${data.dobYear}`; break;
                    case 'firstName': textValue = data.firstName.toUpperCase(); break;
                    case 'endName': textValue = data.endName.toUpperCase(); break;
                    case 'address1': textValue = data.address1; break;
                    case 'address2': textValue = data.address2; break;
                }
                ctx.fillStyle = el.color;
                ctx.font = `bold ${el.size}px Arial`;
                ctx.fillText(textValue, el.x, el.y);
            });
        };
        
        const redrawCanvasFromForm = () => {
             const formData = {
                code: currentCode,
                firstName: dataInputs.firstName.value,
                endName: dataInputs.endName.value,
                address1: dataInputs.address1.value,
                address2: dataInputs.address2.value,
                expDay: pad(dataInputs.expDay.value),
                expMonth: pad(dataInputs.expMonth.value),
                dobDay: pad(dataInputs.dobDay.value),
                dobMonth: pad(dataInputs.dobMonth.value),
                dobYear: dataInputs.dobYear.value
            };
            redrawCanvas(formData);
            const fullName = `${formData.firstName} ${formData.endName}`;
            downloadBtn.download = `${toTitleCase(fullName)}.png`;
        };
        
        const handleBulkGenerate = async () => {
            if (!loadedImage) return;
            
            const count = parseInt(bulkCountInput.value, 10);
            if (isNaN(count) || count <= 0) {
                statusText.textContent = 'Jumlah tidak valid.';
                return;
            }

            bulkGenerateBtn.disabled = true;
            bulkGenerateBtn.innerHTML = `<span class="spinner"></span><span>Memproses...</span>`;

            const zip = new JSZip();
            const staticData = {
                address1: dataInputs.address1.value,
                address2: dataInputs.address2.value,
                dobYear: dataInputs.dobYear.value,
            };

            for (let i = 0; i < count; i++) {
                statusText.textContent = `Membuat kartu ${i + 1} dari ${count}...`;
                const randomData = generateRandomData();
                const cardData = { ...staticData, ...randomData }; // Gabungkan data statis dan acak
                
                redrawCanvas(cardData);
                
                await new Promise(resolve => setTimeout(resolve, 10));

                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                
                const fullName = `${cardData.firstName} ${cardData.endName}`;
                const baseFileName = `${toTitleCase(fullName)}.png`;
                let finalFileName = baseFileName;
                let counter = 1;
                while(zip.files[finalFileName]) {
                    finalFileName = `${toTitleCase(fullName)} (${counter}).png`;
                    counter++;
                }
                zip.file(finalFileName, blob);
            }

            statusText.textContent = 'Membuat file ZIP...';
            const zipBlob = await zip.generateAsync({type:"blob"});

            const link = document.createElement('a');
            link.href = URL.createObjectURL(zipBlob);
            link.download = `kartu_batch_${Date.now()}.zip`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            statusText.textContent = 'Selesai! Unduhan dimulai.';
            bulkGenerateBtn.disabled = false;
            bulkGenerateBtn.innerHTML = `<span>Buat & Unduh ZIP</span>`;
            
            setTimeout(redrawCanvasFromForm, 100);
        };

        // --- Event Listeners ---
        window.addEventListener('load', () => {
            loadImage('https://i.imgur.com/w6NJkY1.jpeg');
        });
        
        randomizeFormBtn.addEventListener('click', populateFormWithRandomData);

        const validationRules = {
            expDay: 31,
            dobDay: 31,
            expMonth: 12,
            dobMonth: 12
        };

        Object.entries(dataInputs).forEach(([key, input]) => {
            input.addEventListener('input', () => {
                // Terapkan validasi jika ada aturan untuk input ini
                if (validationRules[key]) {
                    const max = validationRules[key];
                    if (input.value !== '') {
                        let value = parseInt(input.value, 10);
                        if (isNaN(value)) {
                            input.value = ''; // Hapus input non-numerik
                        } else {
                            if (value > max) input.value = max; // Batasi nilai maksimum
                            if (value < 1) input.value = 1;   // Batasi nilai minimum
                        }
                    }
                }
                // Gambar ulang kanvas setelah setiap perubahan input
                redrawCanvasFromForm();
            });
        });

        downloadBtn.addEventListener('click', function(e) {
            if (!loadedImage) {
                e.preventDefault();
                return;
            };
            this.href = canvas.toDataURL('image/png');
        });

        bulkGenerateBtn.addEventListener('click', handleBulkGenerate);

    </script>
</body>
</html>

